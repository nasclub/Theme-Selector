<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<div id="theme-select-shadow"></div>
<div id="theme-select">
    <div class="theme-select-wrapper">
        <div class="close">
            <i class="material-icons">close</i>
        </div>
        <div class="no-wrap">
            <div class="theme-wrapper">
                <div class="theme theme-default">
                    <div class="theme-name">Default</div>
                    <div class="selected">
                        <div class="theme-chosen"><i class="material-icons">check_circle</i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

if (Cookies.get('currentTheme') == null) {
    Cookies.set('currentTheme', 'default', { expires: 180 });
}

$('#theme-select').siblings('style').attr('id', 'csstheme');
var themeTemplate = $('#csstheme').html();

var changeTheme_default =
        themeTemplate
            .replace(/color1/g, '#ef5350')
            .replace(/color2/g, '#c62828')
            .replace(/color3/g, '#c62828')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Default-min.jpg');
            //.replace(/background_url/g, 'http://puu.sh/ullwD/6e0081198d.jpg');
var changeTheme_purple =
        themeTemplate
            .replace(/color1/g, '#ab47bc')
            .replace(/color2/g, '#7b1fa2')
            .replace(/color3/g, '#7b1fa2')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Purple-min.jpg');
            //.replace(/background_url/g, 'http://puu.sh/tvnb3/ed582e7faa.jpg');
var changeTheme_blue =
        themeTemplate
            .replace(/color1/g, '#42a5f5')
            .replace(/color2/g, '#1976d2')
            .replace(/color3/g, '#1976d2')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Blue-min.jpg');
            //.replace(/background_url/g, 'http://puu.sh/sImea/a45b6d2218.jpg');
var changeTheme_green =
        themeTemplate
            .replace(/color1/g, '#66bb6a')
            .replace(/color2/g, '#388e3c')
            .replace(/color3/g, '#388e3c')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Green-min.png');
            //.replace(/background_url/g, 'http://puu.sh/sJcH9/dcf69640ea.png');
var changeTheme_orange =
        themeTemplate
            .replace(/color1/g, '#ffa726')
            .replace(/color2/g, '#f57c00')
            .replace(/color3/g, '#f57c00')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Orange-min.jpg');
            //.replace(/background_url/g, 'http://puu.sh/sHbUc/27c0d7c0ba.jpg');
var changeTheme_pink =
        themeTemplate
            .replace(/color1/g, '#f48fb1')
            .replace(/color2/g, '#d81b60')
            .replace(/color3/g, '#d81b60')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Pink-min.jpg');
            //.replace(/background_url/g, 'http://puu.sh/ullrV/eefab92a79.jpg');
var changeTheme_black =
        themeTemplate
            .replace(/color1/g, '#9e9e9e')
            .replace(/color2/g, '#616161')
            .replace(/color3/g, '#616161')
            .replace(/background_url/g, 'https://s3.amazonaws.com/files.enjin.com/851662/Theme_Backgrounds_Optimised/Theme-Black-min.png');
            //.replace(/background_url/g, 'http://puu.sh/tvnhx/63d07c16ca.png');

var changeTheme = function() {
    switch (Cookies.get('currentTheme')) {
        case 'default':
            $('#csstheme').html(changeTheme_default);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-default').addClass('active');
            break;
        case 'purple':
            $('#csstheme').html(changeTheme_purple);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-purple').addClass('active');
            break;
        case 'blue':
            $('#csstheme').html(changeTheme_blue);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-blue').addClass('active');
            break;
        case 'green':
            $('#csstheme').html(changeTheme_green);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-green').addClass('active');
            break;
        case 'orange':
            $('#csstheme').html(changeTheme_orange);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-orange').addClass('active');
            break;
        case 'pink':
            $('#csstheme').html(changeTheme_pink);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-pink').addClass('active');
            break;
        case 'black':
            $('#csstheme').html(changeTheme_black);
            $('#theme-select .theme').removeClass('active');
            $('#theme-select .theme.theme-black').addClass('active');
    }
};

var url = "/api/v1/api.php";

var user_info = {
	"jsonrpc": "2.0",
	"id": Math.round(Math.random() * (999999 - 100000) + 100000),
	"method": "User.get",
	"params": {}
};

$.post(url, JSON.stringify(user_info), function(response) {
	if (response.error) {
		console.log(response.error.message);
	} else {
            
        var myID = response.result.user_id;
        var loggedIn = response.result.logged_in;
        var joinedSite = response.result.registered;
        
        var tag_info = {
        	"jsonrpc": "2.0",
        	"id": Math.round(Math.random() * (999999 - 100000) + 100000),
        	"method": "Tags.get",
        	"params": {
        	    "api_key": "c5550244e2427cd146f472df320d59a5b60311815b53fb9f",
        	    "user_id": myID
        	}
        };
        
        $.post(url, JSON.stringify(tag_info), function(response) {
            if (response.error) {
                console.log(response.error.message);
            } else {
                
                var themesTotal = 1;
                
                $('#theme-select .theme.theme-default').click(function() {
                    if (Cookies.get('currentTheme') == 'default') {
                        return;
                    } else {
                        Cookies.set('currentTheme', 'default', { expires: 180 });
                        changeTheme();
                    }
                });
                
                $.each(response.result, function(i, tag) {
                    switch (tag) {
                        case 'Purple Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-purple"><div class="theme-name">Purple Cloud</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-purple').click(function() {
                                if (Cookies.get('currentTheme') == 'purple') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'purple', { expires: 180 });
                                    changeTheme();
                                }
                            });
                            break;
                        case 'Blue Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-blue"><div class="theme-name">Deep Sea</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-blue').click(function() {
                                if (Cookies.get('currentTheme') == 'blue') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'blue', { expires: 180 });
                                    changeTheme();
                                }
                            });
                            break;
                        case 'Green Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-green"><div class="theme-name">Forest Lover</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-green').click(function() {
                                if (Cookies.get('currentTheme') == 'green') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'green', { expires: 180 });
                                    changeTheme();
                                }
                            });
                            break;
                        case 'Orange Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-orange"><div class="theme-name">Burnt Sunset</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-orange').click(function() {
                                if (Cookies.get('currentTheme') == 'orange') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'orange', { expires: 180 });
                                    changeTheme();
                                }
                            });
                            break;
                        case 'Pink Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-pink"><div class="theme-name">Pink Candy</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-pink').click(function() {
                                if (Cookies.get('currentTheme') == 'pink') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'pink', { expires: 180 });
                                    changeTheme();
                                }
                            });
                            break;
                        case 'Black Tag':
                            themesTotal = themesTotal + 1;
                            $('#theme-select .theme-select-wrapper .no-wrap').append('<div class="theme-wrapper"><div class="theme theme-black"><div class="theme-name">Black Sky</div><div class="selected"><div class="theme-chosen"><i class="material-icons">check_circle</i></div></div></div></div>');
                            $('#theme-select .theme.theme-black').click(function() {
                                if (Cookies.get('currentTheme') == 'black') {
                                    return;
                                } else {
                                    Cookies.set('currentTheme', 'black', { expires: 180 });
                                    changeTheme();
                                }
                            });
                    }
                });
                
                $('#theme-select .theme-wrapper').css({'width':'calc(100% / ' + themesTotal + ')'})
                
                $(document).ready(function() {
                    $('#theme-select, #theme-select-shadow').prependTo('body');
                    
                    if ($('#custom-nav').length && loggedIn == true && joinedSite !== false) {
                        $('#custom-nav .custom-nav-wrapper .right').prepend('<div id="theme-select-trigger" style="height: 100%; line-height: 60px;"><a href="javascript:void(0)"><i class="material-icons" style="line-height: 60px;">compare</i> Change Theme</a></div>');
                    } else {
                        $('.m_hmenu_v2 .front-widgets').prepend('<div id="theme-select-trigger"><a href="javascript:void(0)"><i class="material-icons">compare</i> Change Theme</a></div>');
                    }
                    
                    $('#theme-select-trigger > a').click(function() {
                        $('#theme-select-shadow').show();
                        $('#theme-select').addClass('open');
                    });
                    $('#theme-select-shadow, #theme-select .close').click(function() {
                        $('#theme-select-shadow').hide();
                        $('#theme-select').removeClass('open');
                    });
                    changeTheme();
                });
                
            }
        });
        
	}
});

changeTheme();



</script>
